<form [formGroup]="lobbyForm">
  <div class="container mt-3">
    <div class="row justify-content-center">
      <p><em>Version: 1.0.0</em></p>
      &nbsp;-&nbsp;
      <a href="https://github.com/Ronan-H/riffle/blob/master/changelog.md" target="_blank">changelog</a>
    </div>

    <div class="row justify-content-center">
      <button
        class="btn btn-success mt-1"
        (click)="openTutorialModal(tutorialModal)"
      >
        Open Tutorial
      </button>
    </div>

    <hr />

    <div class="row justify-content-center">
      <div class="col-xs-6">
        <h4>Choose a Username</h4>
        <input
          id="username-input"
          formControlName="username"
          type="text"
          class="form-control"
          placeholder="Username"
          required
        />
        <div
          *ngIf="
            lobbyForm.get('username').invalid &&
            lobbyForm.get('username').touched
          "
          class="row justify-content-center"
        >
          <strong>
            <span class="text-danger">Please enter a valid name</span>
          </strong>
        </div>
      </div>
    </div>

    <hr />

    <div class="row justify-content-center">
      <h4>Join a Game</h4>
    </div>
    <div class="row justify-content-center">
      <ng-template #noRooms>
        <p><em>No games currently in progress</em></p>
      </ng-template>
      <div *ngIf="colyseus.allRooms?.length; else noRooms">
        <div class="row justify-content-center">
          <p><em>Click a row to join a game</em></p>
        </div>
        <table class="table table-striped table-bordered table-hover">
          <thead>
            <tr>
              <th scope="col">Room Name</th>
              <th scope="col">Room ID</th>
              <th scope="col">Players</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let room of colyseus.allRooms"
              (click)="tryOpenPasscodeModal(passcodeModal, room.roomId)"
            >
              <th scope="row">{{ room.metadata.roomName }}</th>
              <td>{{ room.roomId }}</td>
              <td>{{ room.clients }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <hr />

    <div class="row justify-content-center">
      <h4>Create a New Game</h4>
    </div>

    <form [formGroup]="createForm">
      <div class="row justify-content-center">
        <div class="col-xs-6">
          <input
            formControlName="roomName"
            type="text"
            class="form-control"
            aria-label="Large"
            placeholder="Game Name"
            required
          />
        </div>
      </div>
      <div class="row justify-content-center">
        <button
          class="btn btn-primary mt-1 mt-3"
          type="submit"
          [disabled]="createForm.invalid || isLoading"
          (click)="createRoom()"
          autofocus
        >
          Create
        </button>
      </div>
    </form>

    <!-- Join Game Passcode Modal -->
    <form [formGroup]="joinForm">
      <ng-template #passcodeModal let-modal>
        <div class="modal-header">
          <h4 class="modal-title" id="modal-basic-title">
            Enter room passcode
          </h4>
        </div>
        <div class="modal-body">
          <div *ngIf="wrongPasscode" class="alert alert-danger" role="alert">
            Incorrect passcode, please try again.
          </div>
          <div class="input-group input-group-lg">
            <input
              formControlName="passcode"
              (keydown.enter)="tryJoinRoom()"
              type="text"
              class="form-control"
              aria-label="Large"
              placeholder="Passcode"
              autofocus
            />
            <button
              class="btn btn-primary"
              type="submit"
              [disabled]="isLoading || joinForm.invalid"
              (click)="tryJoinRoom()"
            >
              Join
            </button>
            <button
              class="btn btn-outline-secondary"
              aria-label="Close"
              (click)="modal.dismiss()"
            >
              Back
            </button>
          </div>
        </div>
      </ng-template>
    </form>

    <!-- Tutorial Modal -->
    <ng-template #tutorialModal let-modal class="tutorial-modal">
      <div class="modal-header">
        <h4 class="modal-title" id="tutorial-heading">
          Tutorial
        </h4>
      </div>
      <div class="modal-body tutorial">
        <ul>
          <li>
            The game is split up into rounds.
          </li>

          <li>
            The goal of each round is to make the best poker hand you can each round.
          </li>
        </ul>

        <div class="row justify-content-center">
          <h3>Example round:</h3>
          <img src="assets/example-round.png" />
        </div>

        <ul>
          <ul>
            <li>
              The top row: these are the shared cards between players, "on the table".
            </li>
  
            <li>
              The bottom row: these are the cards in your own hand. Only you can see these cards.
            </li>
  
            <li>
              The green bar: this shows the remaining time in the round.
            </li>
  
            <li>
              "Currently winning": indicates that you currently have the best hand in round out of all players.
            </li>
          </ul>

          <li>
            To swap a card from the table to your hand, first select the card you want from the top row. Then select a card in your hand to swap.
          </li>

          <li>
            Each round, you will earn points corresponding to the hand you've made.

            <ul>
              <li>
                You will score a large bonus if you have the best hand at the end of the round.
              </li>
            </ul>
          </li>

          <li>
            A showdown concludes each round, showing the result of the round, and the overall scoes of the game.
          </li>
        </ul>

        <div class="row justify-content-center">
          <h3>Hands:</h3>
          <img src="assets/poker-hands.png" />
        </div>

        <hr />

        <div class="row justify-content-center">
          <button
            class="btn btn-primary"
            aria-label="Close"
            (click)="modal.dismiss()"
          >
            Close
          </button>
        </div>
      </div>
    </ng-template>
  </div>
</form>
