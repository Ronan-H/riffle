<div class="container mt-1">
    <div [hidden]="state.gameView !== GameView.GameLobby">
        <div class="text-center">
            <h4>Passcode:</h4>
        </div>
        <div class="text-center">
            <h3 [innerText]="colyseus.gamePasscode"></h3>
        </div>
        <div class="text-center">
            <p [innerText]="
                selfPlayer?.isHost ?
                'Press Start Game when all players have joined.' :
                'Waiting for the host to start the game...'
            "></p>
            <div class="row justify-content-center">
                <button
                    class="btn btn-primary mb-3"
                    type="button"
                    *ngIf="selfPlayer?.isHost"
                    (click)="startGame()"
                >Start Game</button>
            </div>
        </div>
        <hr />
        <div class="text-center" [formGroup]="optionsForm">
            <h4>Options:</h4>

            <div class="font-italic font-weight-bold mb-3">
                <span *ngIf="!this.selfPlayer?.isHost; else notHostSubtext" class="text-danger">
                    Only the host can edit these options
                </span>
                <ng-template #notHostSubtext>
                    <span class="text-success">
                        You are the host - only you can edit these options
                    </span>
                </ng-template>
            </div>

            <div class="row justify-content-center input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Number of Rounds</span>
                </div>
                <div *ngIf="this.selfPlayer?.isHost; else disabledView">
                    <input
                        formControlName="numRounds"
                        type="number"
                        min="1"
                        max="100"
                        class="form-control"
                        aria-describedby="basic-addon1"
                        (focusout)="onOptionsInputFocusOut()"
                        required
                    >
                </div>

                <ng-template #disabledView>
                    <div class="input-group-append">
                        <span class="input-group-text" id="basic-addon1">
                            {{ optionsForm.controls['numRounds'].value }}
                        </span>
                    </div>
                </ng-template>
            </div>
        </div>
        <hr />
        <div class="text-center">
            <h4>Players connected:</h4>
            <ul class="player-list">
                <li *ngFor="let player of playersAsArray" [innerText]="player.name"></li>
            </ul>
        </div>
        <hr />
    </div> 

    <div [hidden]="state.gameView !== GameView.Swapping">
        <strong class="text-center">
            <p class="mb-1" [innerText]="
                selectedCommonIndex === -1 ?
                'Select a card to swap (top row)' :
                'Select a card to swap (bottom row)'">
            </p>
        </strong>
        <div id="card-canvas-div" class="mt-0">
            <canvas
                id="card-canvas"
                #cardCanvas
            ></canvas>
        </div>
        <strong class="text-center" #handInfo>
            <p *ngIf="selfPlayer" class="mb-1">
                Your hand: <span class="text-primary" [innerText]="selfPlayer.currentHandDesc"></span>
                for <span class="text-primary" [innerText]="selfPlayer.currentHandScore"></span> points
                <br />
                <span *ngIf="selfPlayer.isCurrentlyWinning" class="text-success">Currently winning</span>
                <span *ngIf="!selfPlayer.isCurrentlyWinning" class="text-danger">Currently losing</span>
            </p>
        </strong>
    </div>

    <div *ngIf="state.gameView === GameView.Showdown">
        <div class="text-center">
            <div class="row justify-content-center">
                <table class="table table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th class="fit" scope="col">Name</th>
                            <th class="fit" scope="col">Hand</th>
                            <th class="fit" scope="col">Total Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let result of state.showdownResults">
                            <th class="fit" scope="row">{{ result.playerName }}</th>
                            <td class="fit" >
                                {{ result.hand }}
                                <ng-container *ngIf="result.isWinningHand">
                                    <span class="text-success">(WINNER)</span>
                                </ng-container>
                            </td>
                            <td class="fit" >
                                {{ result.totalScore }}
                                <ng-container *ngIf="result.isWinningHand">
                                    <span class="text-success">(+ {{ result.handScore }})</span>
                                </ng-container>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="fixed-bottom">
                <button
                    class="btn btn-primary mb-3"
                    type="button"
                    [disabled]="isNextRoundClicked"
                    (click)="onNextRoundClicked()"
                >
                    {{ isNextRoundClicked ? 'Waiting for others...' : 'Next Round' }} [{{ state.numVotedNextRound }} / {{ state.nextRoundVotesRequired }}]
                </button>
            </div>
        </div>
    </div>
</div>